(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{160:function(t,a,s){"use strict";s.r(a);var n=s(0),v=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"_4-android-客户端接入步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-android-客户端接入步骤","aria-hidden":"true"}},[t._v("#")]),t._v(" 4.Android 客户端接入步骤")]),s("h2",{attrs:{id:"_4-1-接入说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-接入说明","aria-hidden":"true"}},[t._v("#")]),t._v(" 4.1. 接入说明")]),s("p",[t._v("启动支付控件的接口，接口定义如下:")]),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("pay")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Activity activity"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("String tn"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" mode"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("参数说明")]),s("p",[t._v("activity —— 用于启动支付控件的活动对象")]),s("p",[t._v("tn —— 订单信息为交易流水号，即 TN，为商户后台从 AllPay 后台获取")]),s("p",[t._v("mode —— AllPay 后台环境标识，true 将在 AllPay 正式环境发起交易,false 将在 AllPay 测试环 境发起交易")])]),s("h2",{attrs:{id:"_4-2-添加-sdk-包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-添加-sdk-包","aria-hidden":"true"}},[t._v("#")]),t._v(" 4.2. 添加 SDK 包")]),s("ol",[s("li",[t._v("把allpaysdk当做Module导入到自己的工程")]),s("li",[t._v("在Application Module的build.gradle文件的dependencies下添加compile project(':allpaysdk')")]),s("li",[t._v("在Application Module的build.gradle文件中添加")])]),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("repositories "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    flatDir "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        dirs "),s("span",{attrs:{class:"token function"}},[t._v("project")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("':allpaysdk'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("file")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'libs'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"_4-3-调用支付控件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-调用支付控件","aria-hidden":"true"}},[t._v("#")]),t._v(" 4.3. 调用支付控件")]),s("p",[t._v("接着可以通过以下方式调用支付控件:")]),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("/**\n * tn——交易流水号，即 TN，为商户后台从 AllPay 后台获取,获取方式参见 AllPay 网关对接文档\n * false 测试环境\n */")]),t._v("\nAllPayEngine"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("Pay")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ShopCartActivity"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token keyword"}},[t._v("this")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tn"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token boolean"}},[t._v("false")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"_4-4-同步结果通知"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-同步结果通知","aria-hidden":"true"}},[t._v("#")]),t._v(" 4.4. 同步结果通知")]),s("p",[t._v("支付完成后，获取支付控件支付结果，并添加相应处理逻辑，只需实现调用 Activity\n中的 onActivityResult()方法即可,实例代码如下:")]),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("onActivityResult")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" requestCode"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" resultCode"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Intent data"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data "),s("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" null"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),s("span",{attrs:{class:"token keyword"}},[t._v("return")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n   "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("requestCode "),s("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" AllPayConst"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("VTPAY_PAY_REQUESR_CODE"),s("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" resultCode "),s("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" AllPayConst"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("VTPAY_PAY_RESULT_CODE"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       String result "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" data"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("getExtras")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("getString")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"pay_result"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("pay_result,为 json 字符串,格式如下:")]),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('{\n    "state": "cancel",\n    "paymentSchema": "UP",\n    "orderNum": "604337497032",\n    "errorDetail": "user cancel operation "\n}\n')])])]),s("p",[t._v("报文说明:")]),s("ul",[s("li",[t._v('state: "success"代表成功, "cancel"代表用户取消操作,"fail"代表失败,"query"代表 app 需要调用查询接口来确认订单状态')]),s("li",[t._v('paymentSchema: 支付渠道, "APMP"代表支付宝, "WX"代表微信')]),s("li",[t._v("orderNum: 订单号")]),s("li",[t._v("errorDetail: 错误详情")])]),s("h2",{attrs:{id:"_4-5-异步结果通知"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-异步结果通知","aria-hidden":"true"}},[t._v("#")]),t._v(" 4.5. 异步结果通知")]),s("p",[t._v("商户需要提供一个 http 协议的接口，包含在参数里传递给 SDK，即 backURL。AllPay\n服务器在支付完成后，会以 Get 方式调用 backURL，通知支付结果。")]),s("p",[t._v("参数如下表:")]),s("table",[s("thead",[s("tr",[s("th",[t._v("序号")]),s("th",[t._v("名称")]),s("th",[t._v("长度")]),s("th",[t._v("类型")]),s("th",[t._v("参数名称")]),s("th",[t._v("备注")])])]),s("tbody",[s("tr",[s("td",[t._v("1")]),s("td",[t._v("版本号")]),s("td",[t._v("12")]),s("td",[t._v("文本")]),s("td",[t._v("version")]),s("td",[t._v("统一填写为“VER000000002”")])]),s("tr",[s("td",[t._v("2")]),s("td",[t._v("字符集编码")]),s("td",[t._v("6")]),s("td",[t._v("文本")]),s("td",[t._v("charSet")]),s("td",[t._v("统一填写为“UTF-8”")])]),s("tr",[s("td",[t._v("3")]),s("td",[t._v("交易类型")]),s("td",[t._v("4")]),s("td",[t._v("文本")]),s("td",[t._v("transType")]),s("td",[t._v("消费交易填写“PURC”")])]),s("tr",[s("td",[t._v("4")]),s("td",[t._v("订单号")]),s("td",[t._v("60")]),s("td",[t._v("文本")]),s("td",[t._v("orderNum")]),s("td",[t._v("商户自行定义，需保证同一商户号下订单号不能重复")])]),s("tr",[s("td",[t._v("5")]),s("td",[t._v("订单金额")]),s("td",[t._v("12")]),s("td",[t._v("文本")]),s("td",[t._v("orderAmount")]),s("td",[t._v("如 100 元，表示为 100 或 100.00")])]),s("tr",[s("td",[t._v("6")]),s("td",[t._v("订单币种")]),s("td",[t._v("3")]),s("td",[t._v("文本")]),s("td",[t._v("orderCurrency")]),s("td",[t._v('人民币填写“CNY”,美元填写"USD"')])]),s("tr",[s("td",[t._v("7")]),s("td",[t._v("清算金额")]),s("td",[t._v("12")]),s("td",[t._v("文本")]),s("td",[t._v("settAmount")]),s("td",[t._v("如 100 元，表示为 100 或 100.00")])]),s("tr",[s("td",[t._v("8")]),s("td",[t._v("清算币种")]),s("td",[t._v("3")]),s("td",[t._v("文本")]),s("td",[t._v("settCurrency")]),s("td",[t._v("符合 ISO 标准，填写数字类型")])]),s("tr",[s("td",[t._v("9")]),s("td",[t._v("清算汇率")]),s("td",[t._v("7")]),s("td",[t._v("文本")]),s("td",[t._v("rate")]),s("td",[t._v("实际汇率，7 位有效数字")])]),s("tr",[s("td",[t._v("10")]),s("td",[t._v("商户预留字段")]),s("td",[t._v("1024")]),s("td",[t._v("文本")]),s("td",[t._v("merReserve")]),s("td",[t._v("商户预留内容，可传任意内容，如购买商品信息、员号等，但不要传特殊符号，如逗号。")])]),s("tr",[s("td",[t._v("11")]),s("td",[t._v("GW 交易 ID")]),s("td",[t._v("32")]),s("td",[t._v("文本")]),s("td",[t._v("transID")]),s("td",[t._v("GW 系统生成的交易 ID，每笔交易保持唯一")])]),s("tr",[s("td",[t._v("12")]),s("td",[t._v("商户代码")]),s("td",[t._v("15")]),s("td",[t._v("文本")]),s("td",[t._v("merID")]),s("td",[t._v("商户 ID，由AllPay 分配")])]),s("tr",[s("td",[t._v("13")]),s("td",[t._v("收单行 ID")]),s("td",[t._v("11")]),s("td",[t._v("文本")]),s("td",[t._v("acqID")]),s("td",[t._v('收单行 ID "99020344"')])]),s("tr",[s("td",[t._v("14")]),s("td",[t._v("支付渠道代码")]),s("td",[t._v("10")]),s("td",[t._v("文本")]),s("td",[t._v("paymentSchema")]),s("td",[t._v('支付宝:"APMP"; 微信:"WX"; 境外银联:"UP";  ApplePay 支付:"APP" ;印度本地支付:"EB"')])]),s("tr",[s("td",[t._v("15")]),s("td",[t._v("交易应答码")]),s("td",[t._v("2")]),s("td",[t._v("文本")]),s("td",[t._v("RespCode")]),s("td",[t._v("应答码 00-成功")])]),s("tr",[s("td",[t._v("16")]),s("td",[t._v("应答文字信息")]),s("td",[t._v("20")]),s("td",[t._v("文本")]),s("td",[t._v("RespMsg")]),s("td",[t._v("应答消息，全部为英文字符")])]),s("tr",[s("td",[t._v("17")]),s("td",[t._v("交易时间")]),s("td",[t._v("14")]),s("td",[t._v("文本")]),s("td",[t._v("transTime")]),s("td",[t._v('交易时间,格式:"yyyyMMddHHmmss"')])]),s("tr",[s("td",[t._v("18")]),s("td",[t._v("GW 处理时间")]),s("td",[t._v("14")]),s("td",[t._v("文本")]),s("td",[t._v("GWTime")]),s("td",[t._v("YYYYMMDDHHMMSS，为 GW 时间，目前为本地交易时间")])]),s("tr",[s("td",[t._v("19")]),s("td",[t._v("签名类型")]),s("td",[t._v("3")]),s("td",[t._v("文本")]),s("td",[t._v("signType")]),s("td",[t._v("MD5")])]),s("tr",[s("td",[t._v("20")]),s("td",[t._v("签名")]),s("td",[t._v("32")]),s("td",[t._v("文本")]),s("td",[t._v("signature")]),s("td",[t._v("采用 MD5 签名")])])])])])}],!1,null,null,null);a.default=v.exports}}]);